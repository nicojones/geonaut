"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[191],{32367:function(e,t,n){n.d(t,{HW:function(){return i},DM:function(){return m},o0:function(){return u},o_:function(){return s},Mb:function(){return l},xj:function(){return c},_4:function(){return d},Ty:function(){return h},ZG:function(){return f},TW:function(){return g},P9:function(){return p},Mg:function(){return x},_r:function(){return r},NP:function(){return o},Tm:function(){return a}});let r=150,o=6e4*new Date().getTimezoneOffset(),i={"image/jpeg":".jpg","image/png":".png","image/heic":".heic"},a=[8.55,47.38],u=4,s=14,l=864e5,c=6048e5,d=314496e5,f="#8e44ad",g="#27ae60",h="https://travel-api.kupfer.es/images/pictures/ph.png",m={whiteText:"#eee",darkText:"#333"},p="/",x="/dashboard"},1356:function(e,t,n){n.r(t),n.d(t,{EditSelfieContextWrapper:function(){return d}});var r=n(57437),o=n(2265),i=n(42874),a=n(67185),u=n(74598);let s=e=>e.me.img||e.lc.img?{me:!!e.me.img,lc:!!e.lc.img}:void 0,l=e=>Math.abs(e.lat)+Math.abs(e.lng)>0,c=(e,t)=>e&&l(t)?[(0,i.Ww)({...t,active_hash:t.hash},{...e,force:!0})]:[],d=e=>{let{children:t,initialData:n}=e,[d,f]=(0,o.useState)(n),g=(0,o.useMemo)(()=>s(d.images),[d.images]),h=(0,o.useMemo)(()=>l(d.selfie),[d.selfie]),m=(0,o.useMemo)(()=>c(g,d.selfie),[g,d.selfie]),[p,x]=(0,o.useState)({}),v=(0,o.useCallback)(e=>{let t=a.iW.safeParse({...d.selfie,...e});t.success?x({}):x((0,i.Uo)(t.error.issues)),f(t=>({...t,selfie:{...t.selfie,...e}}))},[d]),b=(0,o.useMemo)(()=>({data:d,setData:f,setSelfieData:v,errors:p,setErrors:x,hash:d.selfie.hash,hasImages:g,hasLocation:h,markers:m,_insideContext_:!0}),[g,d,p,v,h,m]);return(0,r.jsx)(u.EditSelfieContext.Provider,{value:b,children:t})}},4387:function(e,t,n){n.r(t),n.d(t,{JwtTokenContextWrapper:function(){return c}});var r=n(57437),o=n(44785),i=n(16463),a=n(2265),u=n(27776),s=n(42874),l=n(50461);let c=e=>{var t;let{children:n,contextData:c}=e,d=null!==(t=o.Z.get("token"))&&void 0!==t?t:null,[f,g]=(0,a.useState)(c.jwt),[h,m]=(0,a.useState)(c.user),p=(0,i.useRouter)(),x=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||!h&&e?m((0,s.JM)(e)):h&&!e&&m(null)},[h]),v=(0,a.useCallback)(e=>{e?o.Z.set("token",e):o.Z.remove("token"),g(e),x(e,!0)},[x]),b=(0,a.useCallback)(e=>(0,s.Cx)(e,f).catch(e=>{throw 401===e.status&&p.push("/auth/logout"+(0,s.L7)({status:e.status})),413===e.status&&u.toast.error("file size too big"),e}),[f,p]),w=(0,a.useMemo)(()=>({jwt:f,setJwt:v,setUser:m,user:h,api:b,isAuthed:!!h,isAdmin:(null==h?void 0:h.id)===1,_insideContext_:!0}),[f,h,b,v]);return(0,a.useEffect)(()=>{x(d)},[x,d]),(0,r.jsx)(l.JwtTokenContext.Provider,{value:w,children:n})}},72023:function(e,t,n){n.r(t),n.d(t,{NotificationsWrapper:function(){return l}});var r=n(57437),o=n(2265),i=n(27776),a=n(42874),u=n(50461),s=n(84655);let l=e=>{let{children:t}=e,{api:n,jwt:l}=(0,u.useJwtTokenContext)(),[c,d]=(0,o.useState)(10),[f,g]=(0,o.useState)([]),[h,m]=(0,o.useState)(0),p=(0,o.useCallback)(e=>{n({url:"/api/notifications?limit=".concat(c),signal:e}).then(a.xO).then(e=>{g(e.notifications),m(e.unread)})},[n,c]),x=(0,o.useCallback)((e,t)=>{n({url:"/api/notifications/mark",body:{unread:Number(!t),id:e}}).then(a.xO).then(e=>{m(e.unread),p()}).catch(e=>{console.error(e),i.toast.error(String(e))})},[n,p]),v=(0,o.useCallback)(e=>{g(t=>[...t.map(t=>({...t,seen:t.id===e?new Date().toISOString():t.seen}))]),m(e=>Math.max(0,(null!=e?e:0)-1)),x(e,!0)},[x]),b=(0,o.useCallback)(e=>{g(t=>[...t.map(t=>({...t,seen:t.id===e?null:t.seen}))]),m(e=>(null!=e?e:0)+1),x(e,!1)},[x]),w=(0,o.useMemo)(()=>({notifications:f,markAsUnead:b,markAsRead:v,unread:h,loadMore:()=>d(e=>e+10),_insideContext_:!0}),[v,b,f,h]);return(0,o.useEffect)(()=>{if(!l)return;let e=new AbortController,t=setTimeout(()=>p(e.signal),1e3),n=setInterval(()=>p(e.signal),2e4);return()=>{e.abort(),clearTimeout(t),clearInterval(n)}},[p,l,c]),(0,r.jsx)(s.NotificationsContext.Provider,{value:w,children:t})}},74598:function(e,t,n){n.r(t),n.d(t,{EditSelfieContext:function(){return o},useEditSelfieContext:function(){return i}});var r=n(2265);let o=(0,r.createContext)({data:{},setData:()=>null,setSelfieData:()=>null,errors:{},setErrors:()=>null,hash:"",hasImages:void 0,hasLocation:!1,markers:[],_insideContext_:!1}),i=()=>{let e=(0,r.useContext)(o);if(!e._insideContext_)throw Error("`useEditSelfieContext` must be used inside of `EditSelfieContext`.");return e}},70191:function(e,t,n){n.d(t,{Rv:function(){return r.useJwtTokenContext},dV:function(){return o.useEditSelfieContext},lR:function(){return i.useNotificationsContext},qF:function(){return a.NotificationsWrapper}});var r=n(50461);n(4387);var o=n(74598);n(1356);var i=n(84655),a=n(72023)},50461:function(e,t,n){n.r(t),n.d(t,{JwtTokenContext:function(){return o},useJwtTokenContext:function(){return i}});var r=n(2265);let o=(0,r.createContext)({jwt:null,setJwt:()=>null,user:null,setUser:()=>null,isAdmin:!1,isAuthed:!1,api:Promise.resolve,_insideContext_:!1}),i=e=>{let t=(0,r.useContext)(o);if(!t._insideContext_)throw Error("`useJwtTokenContext` must be used inside of `JwtTokenContext`.");return(null==e?void 0:e.redirect)&&!t.isAuthed&&"string"==typeof t.jwt&&(window.location.href=e.redirect),t}},84655:function(e,t,n){n.r(t),n.d(t,{NotificationsContext:function(){return o},useNotificationsContext:function(){return i}});var r=n(2265);let o=(0,r.createContext)({notifications:[],markAsRead:()=>null,markAsUnead:()=>null,loadMore:()=>null,unread:void 0,_insideContext_:!1}),i=()=>{let e=(0,r.useContext)(o);if(!e._insideContext_)throw Error("`useNotificationsContext` must be used inside of `NotificationsContext`.");return e}},42874:function(e,t,n){n.d(t,{vQ:function(){return o},Uo:function(){return i},gw:function(){return a},G0:function(){return M},p6:function(){return k},Cx:function(){return u},r7:function(){return W},JM:function(){return l},ZE:function(){return b},jA:function(){return p},Ij:function(){return g},ZP:function(){return _},gY:function(){return C},xO:function(){return w},kb:function(){return c},HP:function(){return x},w6:function(){return D},OH:function(){return U},t6:function(){return O},Jm:function(){return N},Jj:function(){return j},iQ:function(){return E},qH:function(){return h},Ww:function(){return J},SH:function(){return A},Sy:function(){return T},L7:function(){return v}});var r=n(27776);let o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;navigator.clipboard.writeText(e).then(()=>{n&&(0,r.toast)(n),null==t||t()})},i=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};return e.forEach(e=>{let t;let r=n;e.path.forEach((n,o)=>{var i,a;"string"==typeof n?(t=[],r[n]=null!==(i=r[n])&&void 0!==i?i:t):"number"==typeof n&&(t={},r[n]=null!==(a=r[n])&&void 0!==a?a:t);let u=o===e.path.length-1?e.message:void 0;u?r[n]=u:r=r[n]})}),t&&console.error(n),n},a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return setTimeout(e,t)},u=function(e){let{method:t="POST",body:n,url:r="/api/selfies",contentType:o="application/x-www-form-urlencoded",signal:i,cache:a,cacheTags:u=[]}=e,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return fetch("".concat("https://travel-api.kupfer.es").concat(r),{signal:i,next:{cache:a,tags:u},method:null!=t?t:"POST",headers:{...!1===o?{}:{"Content-Type":o},...s?{Authorization:"Bearer ".concat(s)}:{}},body:n?n instanceof FormData?n:new URLSearchParams(n).toString():void 0,credentials:"include"}).then(e=>{let t=e.status,n=e.ok;try{return e.json().then(e=>{if(n)return e.status=t,e;if(e)throw{...e,status:t};throw{success:0,status:t,responseData:e}})}catch(n){throw console.log("POTATO DEBUG -- tried to parse json",e),{success:0,status:t,responseData:{}}}})};var s=n(49714);let l=e=>{var t,n;return e&&null!==(n=null===(t=(0,s.o)(e))||void 0===t?void 0:t.data)&&void 0!==n?n:null},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=()=>Math.floor((1+Math.random())*65536).toString(16).substring(1);return"".concat(e).concat(t(),"-").concat(t())};var d=n(56800),f=n.n(d);let g=e=>f()("has-loading-mask",{"is-loading-mask":e.loading},{"cursor-wait":e.fetching},{"has-spinner":e.spinner}),h=e=>void 0===e?"":m(e.selfies.length,!!e.more),m=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return void 0===e?"":1===e?"(1 result)":"(".concat(e).concat(t?"+":""," results)")},p=e=>Array.isArray(e)?e[e.length-1]:e,x=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),v=e=>{let t=Object.keys(e);if(!(Object.values(e).filter(Boolean).length>0))return"";let n=[];for(let r=0,o=t.length;r<o;++r)n.push("".concat(encodeURIComponent(t[r]),"=").concat(encodeURIComponent(e[t[r]])));return"?"+n.join("&")},b=()=>Math.round(+new Date/1e4),w=e=>{if(e.success)return e.responseData;throw console.error("UNSUCCESSFUL",e),e.responseData},C=(e,t)=>"".concat(e," ").concat(t[Number(1!==e)]),k=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e=>e.toString().padStart(2,"0"),r=n(e.getHours()),o=n(e.getMinutes()),i=n(e.getDate()),a=n(e.getMonth()+1),u=e.getFullYear();return t||e.getHours()+e.getMinutes()===0?"".concat(i,"-").concat(a,"-").concat(u):"".concat(r,":").concat(o," ").concat(i,"-").concat(a,"-").concat(u)};var y=n(48952),S=n(32367);let _=e=>{let t=e;if("string"==typeof e&&(t=new Date(+new Date(e)-S.NP)),isNaN(t)&&(t=new Date(e)),isNaN(t))throw Error('Invalid date! "'.concat(String(e),'"'));return t},z="date-locale";(0,y.z2)(z,function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(1e3*n<S.Mb){let e=+new Date;if(new Date().getDate()===new Date(e-(null!=n?n:0)).getDate())return["today","today"]}return[["today","today"],["today","today"],["today","today"],["today","today"],["recently","today"],["recently","recently"],["yesterday","tomorrow"],["%s days ago","in %s days"],["1 week ago","in 1 week"],["%s weeks ago","in %s weeks"],["1 month ago","in 1 month"],["%s months ago","in %s months"],["1 year ago","in 1 year"],["%s years ago","in %s years"]][t]});let T=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,y.WU)(_(e),t?z:void 0)},D=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=[];void 0===t&&(t=e,e=0);for(let o=e;o<t;o+=n)r.push(o);return r},M=(e,t,n)=>{var o;if((null===(o=prompt('Type "delete" to permanently delete the selfie'))||void 0===o?void 0:o.toLowerCase())==="delete"){let o=e({method:"DELETE",url:"/api/selfie/delete/".concat(t.hash)}).then(w);r.toast.promise(o,{success:e=>(n(e),"".concat(t.name," Deleted!")),error:e=>(console.error(e),String(e))})}},E=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"".concat("https://travel-api.kupfer.es","/images/pictures/uploads/").concat(e.hash,"/").concat(t?"mini_":"","me.jpg")},j=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"".concat("https://travel-api.kupfer.es","/images/pictures/uploads/").concat(e.hash,"/").concat(t?"mini_":"","lc.jpg")},N=e=>"".concat("https://travel-api.kupfer.es","/images/pictures/uploads/").concat(e.hash,"/cp.jpg"),A=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"me";return("me"===t?e.me_brightness:e.lc_brightness)<120?S.DM.whiteText:S.DM.darkText},P=(e,t)=>t?"edit"===t?"/edit/".concat(e):"/s/".concat(e):"#",J=function(e){var t,n,r;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.lc=null===(t=o.lc)||void 0===t||t,o.me=null===(n=o.me)||void 0===n||n,o.url=null!==(r=o.url)&&void 0!==r?r:void 0;let i=o.force?"?t=".concat(+new Date):"",a="<div class='empty-div'>";return a+='<a href="'.concat(P(e.active_hash,o.url),'"'),o.me&&o.lc?a+=' class="'.concat(f()("rounded-pin-double",{openable:!!o.url}),'" >')+'\n      <span class="rounded-pin-double-one"><img src="'.concat(E(e,!0)+i,'"/></span>\n      <span class="rounded-pin-double-two"><img src="').concat(j(e,!0)+i,'"/></span>\n    ')+"</a>":(a+=' class="'.concat(f()("rounded-pin",{openable:!!o.url}),'"'),o.me?a+=" style=\"background-image: url('".concat(E(e,!0)+i,"')\" ></a>"):o.lc?a+=" style=\"background-image: url('".concat(j(e,!0)+i,"')\" ></a>"):a+=">(none)</a>"),a+="</div>",{lat:e.lat,lng:e.lng,icon:a}},U=(e,t)=>"linear-gradient(0.25turn,rgb(".concat(e,"),rgb(").concat(t,"))"),O=e=>"0 1px 60px 20px rgb(".concat(e,")"),W=e=>"(".concat(e.lat.toFixed(4),", ").concat(e.lng.toFixed(4),")")},67185:function(e,t,n){n.d(t,{iW:function(){return u},L4:function(){return a}});var r=n(59772);let o=r.z.enum(["menu","top"]),i=r.z.union([r.z.literal(0),r.z.literal(1),r.z.literal(2)]),a=r.z.object({bell_position:o,email:r.z.string().email(),name:r.z.string().min(5),short_desc:r.z.string().min(5),profile_pic:r.z.string().min(1),gender:i,username:r.z.string().min(4),password:r.z.string().min(8).optional(),confirm:r.z.string().min(8).optional()}).superRefine((e,t)=>{let{confirm:n,password:r}=e;n!==r&&t.addIssue({code:"custom",message:"the passwords do not match",path:["confirm"]})}),u=r.z.object({title:r.z.string().min(5,"Title must be at least 5 characters long"),subtitle:r.z.string().min(10,"Subtitle must be between 5 and 100 characters long").max(100,"Subtitle must be between 5 and 100 characters long"),date:r.z.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Date must be in yyyy-mm-dd format"),place:r.z.string().min(1,"Place must not be empty"),lat:r.z.number().refine(e=>0!==e,{message:"Latitude cannot be 0"}),lng:r.z.number().refine(e=>0!==e,{message:"Longitude cannot be 0"}),description:r.z.string(),url:r.z.string(),hash:r.z.string(),visible:r.z.boolean(),draft:r.z.boolean()})}}]);